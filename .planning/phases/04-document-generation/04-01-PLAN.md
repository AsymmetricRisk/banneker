---
phase: 04-document-generation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - templates/agents/banneker-architect.md
  - templates/config/document-catalog.md
autonomous: true

must_haves:
  truths:
    - "Architect agent determines which documents to generate based on survey signals"
    - "Architect agent sequences document generation in dependency order (waves)"
    - "Architect agent builds a term registry from survey.json for consistency enforcement"
    - "Architect agent validates writer output for placeholders and consistency"
  artifacts:
    - path: "templates/agents/banneker-architect.md"
      provides: "Architect sub-agent instructions"
      min_lines: 150
      contains: "banneker-architect"
    - path: "templates/config/document-catalog.md"
      provides: "Conditional document selection rules and document structure reference"
      min_lines: 80
      contains: "TECHNICAL-SUMMARY"
  key_links:
    - from: "templates/agents/banneker-architect.md"
      to: ".banneker/survey.json"
      via: "reads survey data as input"
      pattern: "survey.json"
    - from: "templates/agents/banneker-architect.md"
      to: "templates/agents/banneker-writer.md"
      via: "spawns writer via Task tool"
      pattern: "banneker-writer"
    - from: "templates/agents/banneker-architect.md"
      to: "templates/config/document-catalog.md"
      via: "references catalog for conditional rules"
      pattern: "document-catalog"
---

<objective>
Create the banneker-architect sub-agent and document catalog reference file.

Purpose: The architect agent is the orchestration brain of document generation — it reads survey.json and architecture-decisions.json, determines which documents to generate based on project type signals, builds a term registry for naming consistency, resolves dependency order into generation waves, spawns writer agents, and validates outputs.

Output: Two files — the architect agent markdown (templates/agents/banneker-architect.md) and a document catalog reference (templates/config/document-catalog.md) that defines conditional generation rules, document structures, and quality standards.
</objective>

<execution_context>
@/home/daniel/.claude/get-shit-done/workflows/execute-plan.md
@/home/daniel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-document-generation/04-RESEARCH.md

# Existing agent pattern to follow
@templates/agents/banneker-surveyor.md

# Sample data files the architect will consume
@.banneker/survey.json
@.banneker/architecture-decisions.json

# Sample output documents showing target quality
@.banneker/documents/TECHNICAL-SUMMARY.md
@.banneker/documents/STACK.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create document-catalog.md reference file</name>
  <files>templates/config/document-catalog.md</files>
  <action>
Create `templates/config/document-catalog.md` — a reference file that the architect agent consults for conditional document selection and document structure definitions.

This file must contain:

**1. Always-Generated Documents (REQ-DOCS-001):**
Define three documents that are always generated regardless of project type:
- TECHNICAL-SUMMARY.md — project overview, actors, technology stack, core value, key decisions
- STACK.md — detailed technology stack with rationale, hosting, integrations, constraints
- INFRASTRUCTURE-ARCHITECTURE.md — system topology, data flows, deployment architecture, security boundaries

For each: section headings, purpose of each section, what survey data maps to each section.

**2. Conditional Documents with Signal Detection Rules (REQ-DOCS-002):**
For each of these 7 conditional documents, define:
- The document name
- The signal detection rule (which survey.json fields trigger generation)
- Section headings and purpose
- What survey data maps to each section

Documents and their trigger conditions:
- TECHNICAL-DRAFT.md: triggered when `survey.backend` exists and has `data_stores` with length > 0
- DEVELOPER-HANDBOOK.md: triggered when actors include a developer-type actor AND backend exists
- DESIGN-SYSTEM.md: triggered when `survey.project.type` includes "web", "portal", or "frontend", OR walkthroughs include UI-related flows
- PORTAL-INTEGRATION.md: triggered when `survey.backend.integrations` has length > 0
- OPERATIONS-RUNBOOK.md: triggered when `survey.backend.hosting` exists with a `platform` field
- LEGAL-PLAN.md: triggered when `survey.rubric_coverage.covered` includes items starting with "LEGAL-"
- CONTENT-ARCHITECTURE.md: triggered when walkthroughs include content-focused flows (create, edit, publish patterns)

**3. Dependency Graph (REQ-DOCS-006):**
Define which documents depend on which:
- Wave 1 (no dependencies): TECHNICAL-SUMMARY, STACK
- Wave 2 (depends on STACK): TECHNICAL-DRAFT, INFRASTRUCTURE-ARCHITECTURE
- Wave 3 (depends on INFRASTRUCTURE-ARCHITECTURE): DEVELOPER-HANDBOOK
- Wave 4 (no inter-document dependencies): DESIGN-SYSTEM, PORTAL-INTEGRATION, OPERATIONS-RUNBOOK, LEGAL-PLAN, CONTENT-ARCHITECTURE

**4. Quality Standards (REQ-DOCS-003, REQ-DOCS-004, REQ-DOCS-005):**
- Placeholder patterns to reject: `[TODO`, `[PLACEHOLDER`, `TBD`, `FIXME`, `XXX`, `<variable_name>`, `<!-- BANNEKER:`, `{{`, `{%`
- Term consistency rules: project name, actor names, technology names, entity names must match survey.json exactly
- Decision citation format: `(DEC-XXX)` inline where architectural choices are discussed

**Format:** Use markdown with clear section headers. NO YAML frontmatter (this is a reference file, not an agent or command). Use tables for document definitions and code blocks for signal detection pseudocode.

**Do NOT include:** Full document templates or example content. The writer agent generates narrative content; this file only defines structure and rules.
  </action>
  <verify>
Read the file and verify:
1. All 10 document types are defined (3 always + 7 conditional)
2. Each conditional document has an explicit signal detection rule referencing survey.json fields
3. Dependency graph covers all 10 documents with wave assignments
4. Quality standards section lists placeholder patterns, term consistency rules, and citation format
5. File has no YAML frontmatter (it's a reference, not an agent)
  </verify>
  <done>document-catalog.md exists at templates/config/ with complete conditional rules for all 10 document types, dependency graph, and quality standards</done>
</task>

<task type="auto">
  <name>Task 2: Create banneker-architect.md sub-agent</name>
  <files>templates/agents/banneker-architect.md</files>
  <action>
Create `templates/agents/banneker-architect.md` — the architect sub-agent that orchestrates document generation.

**YAML frontmatter** (follow banneker-surveyor.md pattern exactly):
```yaml
---
name: banneker-architect
description: "Sub-agent that determines which documents to generate based on survey signals, builds a term registry for consistency, resolves dependency order, spawns writer agents, and validates outputs."
---
```

**Markdown body** must include these sections:

**1. Role Introduction:**
You are the Banneker Architect. You transform survey data into a complete suite of project-specific planning documents. You are the planner and dispatcher — you determine WHAT to generate, in WHAT order, and validate the results. You do NOT write document content yourself; you spawn banneker-writer agents for that.

**2. Input Files:**
- `.banneker/survey.json` — project survey data (read with Read tool)
- `.banneker/architecture-decisions.json` — decision log with DEC-XXX IDs (read with Read tool)
- `document-catalog.md` — reference for conditional rules and document structure (loaded from installed config location)

**3. Output Files:**
- `.banneker/documents/*.md` — generated planning documents
- `.banneker/state/architect-state.md` — generation state for resume capability

**4. Step 1: Load and Parse Inputs**
Read survey.json and architecture-decisions.json. Verify both parse as valid JSON. If either is missing, report error and stop.

**5. Step 2: Determine Document Set**
Apply signal detection rules from document-catalog.md:
- Always include: TECHNICAL-SUMMARY, STACK, INFRASTRUCTURE-ARCHITECTURE
- Apply each conditional rule against survey data
- Log which signals were detected and which documents were triggered
- Format: "Signal: survey.backend.data_stores.length=2 → TECHNICAL-DRAFT.md triggered"

**6. Step 3: Build Term Registry**
Extract canonical names from survey.json:
- `projectName`: from `survey.project.name`
- `actors`: from `survey.actors[].name` (exact list)
- `technologies`: from backend stack entries + decision choices that are technology names
- `entities`: from `survey.backend.data_stores[].entities` if backend exists
- `integrations`: from `survey.backend.integrations[].name` if backend exists

Include the term registry in every writer agent spawn. Instruct: "Use these exact names. Do not use synonyms, abbreviations, or alternative capitalizations."

**7. Step 4: Resolve Dependency Order**
Compute generation waves per document-catalog.md dependency graph. Only include documents from the determined document set (Step 2).

**8. Step 5: Execute Waves**
For each wave sequentially:
  For each document in the wave:
    Spawn `banneker-writer` via Task tool with these parameters:
    - document_type: the document name (e.g., "TECHNICAL-SUMMARY")
    - survey_data: full survey.json content
    - decisions: full architecture-decisions.json content
    - term_registry: the canonical names built in Step 3
    - document_structure: section headings and purpose from document-catalog.md for this document type
    - dependencies: content of already-generated documents that this one references
    Wait for writer to complete.

After each writer returns, run validation (Step 6).

**9. Step 6: Validate Writer Output (REQ-DOCS-003, REQ-DOCS-004, REQ-DOCS-005)**
For each generated document:

Placeholder check (REQ-DOCS-003):
- Scan for: `[TODO`, `[PLACEHOLDER`, `TBD`, `FIXME`, `XXX`, `<variable>` patterns, `<!-- BANNEKER:`, `{{`, `{%`
- If ANY found: reject document, log specific violations, stop generation

Term consistency check (REQ-DOCS-004):
- Verify project name matches term_registry.projectName
- Verify actor references match term_registry.actors
- Verify technology names match term_registry.technologies
- If mismatches found: reject document, log violations, stop generation

Decision citation check (REQ-DOCS-005):
- Extract all DEC-XXX references from document
- Verify each exists in architecture-decisions.json
- If non-existent references found: warn (do not reject)

**10. Step 7: State Management**
After each document completes validation:
- Update `.banneker/state/architect-state.md` with:
  - Which documents are complete
  - Which wave is current
  - Term registry (for resume)
  - Any warnings
- On full completion: delete state file

**11. Step 8: Report Results**
List all generated documents with file paths and sizes. Report any warnings. Suggest next steps: "Run /banneker:roadmap to generate architecture diagrams."

**12. Resume Handling**
When spawned with existing architect-state.md:
- Read state file
- Skip already-completed documents
- Resume from current wave
- Show user what was already generated

**13. Error Handling**
- If survey.json missing: "No survey data found. Run /banneker:survey first."
- If architecture-decisions.json missing: "No decisions found. Run /banneker:survey first."
- If validation fails: Stop generation, preserve state file, report specific failures
- If writer agent fails: Stop, preserve state, report error

**Important:** Follow the same markdown formatting style as banneker-surveyor.md — clear section headers, bullet points for instructions, code blocks for file paths and commands. The agent is spawned by the architect command orchestrator, not invoked directly by users.
  </action>
  <verify>
Read the file and verify:
1. YAML frontmatter has name: banneker-architect and description field
2. All 8 steps are present (Load, Determine, Registry, Order, Execute, Validate, State, Report)
3. Signal detection rules reference survey.json field paths
4. Term registry extraction covers projectName, actors, technologies, entities, integrations
5. Validation section covers all three checks: placeholder, consistency, citations
6. Resume handling section exists
7. Writer spawning references banneker-writer by name
8. File is at least 150 lines
  </verify>
  <done>banneker-architect.md agent exists at templates/agents/ with complete orchestration instructions covering document set determination, term registry, dependency ordering, writer spawning, and output validation</done>
</task>

</tasks>

<verification>
1. `templates/agents/banneker-architect.md` exists with valid YAML frontmatter (name + description)
2. `templates/config/document-catalog.md` exists with all 10 document definitions
3. Architect agent references banneker-writer for spawning
4. Architect agent references document-catalog for conditional rules
5. All REQ-DOCS requirements (001-006) are addressed in the architect's workflow
6. Architect agent follows the same markdown style as banneker-surveyor.md
</verification>

<success_criteria>
- banneker-architect.md agent file has YAML frontmatter matching established pattern
- document-catalog.md defines all 3 always-generated and 7 conditional documents with signal rules
- Architect workflow covers: input loading, signal detection, term registry, dependency ordering, writer spawning, validation, state management, reporting
- No placeholder content in either file — all rules and instructions are specific
</success_criteria>

<output>
After completion, create `.planning/phases/04-document-generation/04-01-SUMMARY.md`
</output>
