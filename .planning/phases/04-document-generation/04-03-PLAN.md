---
phase: 04-document-generation
plan: 03
type: execute
wave: 2
depends_on: ["04-01", "04-02"]
files_modified:
  - templates/commands/banneker-architect.md
autonomous: true

must_haves:
  truths:
    - "/banneker:architect command detects resume state before starting"
    - "/banneker:architect command spawns banneker-architect sub-agent via Task tool"
    - "/banneker:architect command verifies output documents exist after completion"
    - "Command handles missing survey.json with actionable error message"
  artifacts:
    - path: "templates/commands/banneker-architect.md"
      provides: "Skill command that orchestrates document generation lifecycle"
      min_lines: 80
      contains: "banneker-architect"
  key_links:
    - from: "templates/commands/banneker-architect.md"
      to: "templates/agents/banneker-architect.md"
      via: "spawns architect agent via Task tool"
      pattern: "banneker-architect"
    - from: "templates/commands/banneker-architect.md"
      to: ".banneker/survey.json"
      via: "checks for survey data before spawning"
      pattern: "survey.json"
    - from: "templates/commands/banneker-architect.md"
      to: ".banneker/documents/"
      via: "verifies output documents after completion"
      pattern: ".banneker/documents/"
---

<objective>
Create the banneker-architect command skill file that orchestrates the document generation lifecycle.

Purpose: This is the user-facing entry point for document generation. When a user runs `/banneker:architect`, this command handles the lifecycle: checks for prerequisites (survey.json), detects resume state, spawns the architect sub-agent, and verifies outputs on completion. It mirrors the pattern established by banneker-survey.md.

Output: One file — the command skill (templates/commands/banneker-architect.md) that manages the document generation lifecycle.
</objective>

<execution_context>
@/home/daniel/.claude/get-shit-done/workflows/execute-plan.md
@/home/daniel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Established command pattern to follow exactly
@templates/commands/banneker-survey.md

# The agent this command spawns
@templates/agents/banneker-architect.md

# Prior plan summaries for context on command/agent pattern
@.planning/phases/03-survey-pipeline/03-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create banneker-architect.md command skill file</name>
  <files>templates/commands/banneker-architect.md</files>
  <action>
Create `templates/commands/banneker-architect.md` — the skill command that orchestrates document generation. Follow the exact pattern established by `templates/commands/banneker-survey.md`.

**YAML frontmatter:**
```yaml
---
name: banneker-architect
description: "Generate project-specific planning documents from survey data. Determines which documents to create based on project type, generates them in dependency order, and validates for zero placeholders and consistent naming. Handles interruption by saving state and offers resume on restart."
---
```

**Markdown body — follow banneker-survey.md structure exactly:**

**Section: Title and Role**
```
# banneker-architect

You are the architect command orchestrator. Your job is to manage the document generation lifecycle: check prerequisites, detect resume conditions, spawn the architect sub-agent to determine and generate documents, and verify outputs on completion.
```

**Step 0: Prerequisite Check (MANDATORY)**

Check that survey data exists before proceeding:

```bash
cat .banneker/survey.json 2>/dev/null
```

If `.banneker/survey.json` does NOT exist:
- Display: "No survey data found at .banneker/survey.json"
- Display: "Run /banneker:survey first to conduct a discovery interview."
- Abort and exit.

```bash
cat .banneker/architecture-decisions.json 2>/dev/null
```

If `.banneker/architecture-decisions.json` does NOT exist:
- Display: "No architecture decisions found at .banneker/architecture-decisions.json"
- Display: "Run /banneker:survey first — the decision gate phase creates this file."
- Abort and exit.

**Step 1: Resume Detection (REQ-CONT-002)**

Check for interrupted generation:

```bash
cat .banneker/state/architect-state.md 2>/dev/null
```

If the file exists:
1. Parse the state to identify which documents are already complete
2. Display: "Found interrupted document generation. Completed: [list]. Remaining: [list]."
3. Prompt: "Resume generation? (y/N)"
   - If yes: Proceed to Step 2 with resume context
   - If no: Prompt "Start fresh? This will regenerate all documents. (y/N)"
     - If yes: Delete architect-state.md and proceed to Step 2
     - If no: Abort

Check for existing documents:

```bash
ls .banneker/documents/*.md 2>/dev/null
```

If documents already exist AND no state file:
1. Display: "Existing documents found at .banneker/documents/"
2. List the existing documents
3. Prompt: "Overwrite with fresh generation? (y/N)"
   - If yes: Proceed to Step 2
   - If no: Abort

If neither state file nor documents exist: Proceed to Step 2 as fresh start.

**Step 2: Ensure Directory Structure**

```bash
mkdir -p .banneker/documents
mkdir -p .banneker/state
```

**Step 3: Spawn Architect Sub-Agent**

Use the Task tool to spawn the `banneker-architect` sub-agent:

- Task name: "Determine document set and generate planning documents"
- Agent reference: `banneker-architect`
- Context to pass:
  - If resuming: Pass full content of `.banneker/state/architect-state.md` with instruction: "Resume from the current state. Skip already-completed documents and continue from the current wave."
  - If fresh start: Pass: "Fresh start — no prior state. Begin with Step 1: Load and Parse Inputs."

Wait for the architect sub-agent to return.

**Step 4: Verify Completion**

After the architect returns, verify outputs:

Check that at minimum the 3 always-generated documents exist:

```bash
cat .banneker/documents/TECHNICAL-SUMMARY.md 2>/dev/null
cat .banneker/documents/STACK.md 2>/dev/null
cat .banneker/documents/INFRASTRUCTURE-ARCHITECTURE.md 2>/dev/null
```

1. Verify each required file exists and is non-empty
2. Count total documents generated

Display results:

**On success:**
```
Document generation complete!

Generated documents:
  - .banneker/documents/TECHNICAL-SUMMARY.md
  - .banneker/documents/STACK.md
  - .banneker/documents/INFRASTRUCTURE-ARCHITECTURE.md
  [+ any conditional documents]

Total: [N] documents generated

Next steps:
  - Review the generated documents in .banneker/documents/
  - Run /banneker:roadmap to generate architecture diagrams
  - Run /banneker:appendix to compile HTML reference
```

**On failure:**
```
Document generation incomplete

Missing required documents:
  - [list of missing files]

State file preserved at .banneker/state/architect-state.md for debugging.

To retry: Run /banneker:architect again to resume from where it stopped.
```

Do not delete the state file on failure.

**Important Implementation Notes:**
- This skill file runs inside an AI runtime (Claude Code, OpenCode, Gemini). All file operations are via the runtime's Bash tool.
- The orchestrator is lean — all document selection, generation, and validation logic lives in the banneker-architect agent, not here.
- Resume detection is MANDATORY per REQ-CONT-002.
- The state file is the architect agent's responsibility to write/update/delete, not the orchestrator's.
- This file is the user-facing entry point for `/banneker:architect`.

**Requirements Coverage:**
- REQ-CONT-001: State tracking via `.banneker/state/architect-state.md`
- REQ-CONT-002: Resume detection in Step 1
- REQ-DOCS-001: Verification of 3 always-generated documents in Step 4
- REQ-DOCS-002: Conditional documents handled by architect agent
  </action>
  <verify>
Read the file and verify:
1. YAML frontmatter has name: banneker-architect and description field
2. Step 0 checks for survey.json and architecture-decisions.json
3. Step 1 handles resume detection (state file check + existing documents check)
4. Step 2 creates directory structure
5. Step 3 spawns banneker-architect sub-agent via Task tool
6. Step 4 verifies at minimum 3 required documents exist
7. Success and failure messages are specific and actionable
8. Requirements coverage section lists REQ-CONT-001, REQ-CONT-002, REQ-DOCS-001, REQ-DOCS-002
9. Structure mirrors banneker-survey.md pattern
  </verify>
  <done>banneker-architect.md command exists at templates/commands/ with prerequisite checking, resume detection, architect agent spawning, and output verification</done>
</task>

</tasks>

<verification>
1. `templates/commands/banneker-architect.md` exists with valid YAML frontmatter
2. Command follows banneker-survey.md structure (Step 0 → Step N pattern)
3. Prerequisite checks prevent running without survey data
4. Resume detection handles both state file and existing documents
5. Spawns banneker-architect agent via Task tool
6. Verifies required output documents after completion
</verification>

<success_criteria>
- banneker-architect.md command has YAML frontmatter matching established pattern
- Prerequisite check catches missing survey.json with actionable message
- Resume detection handles interrupted state and existing documents
- Agent spawning passes correct context for fresh start vs. resume
- Output verification checks for 3 always-required documents
- Success/failure messages are specific and helpful
</success_criteria>

<output>
After completion, create `.planning/phases/04-document-generation/04-03-SUMMARY.md`
</output>
