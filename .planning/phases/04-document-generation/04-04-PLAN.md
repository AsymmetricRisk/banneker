---
phase: 04-document-generation
plan: 04
type: execute
wave: 2
depends_on: ["04-01", "04-02", "04-03"]
files_modified:
  - lib/constants.js
  - test/integration/skill-validation.test.js
  - test/smoke/full-install.test.js
autonomous: true

must_haves:
  truths:
    - "BANNEKER_FILES manifest includes all new agent and command files"
    - "AGENT_FILES array includes both architect and writer agents"
    - "Integration tests validate YAML frontmatter of new agent and command files"
    - "Smoke test verifies new files are installed to correct directories"
  artifacts:
    - path: "lib/constants.js"
      provides: "Updated file manifest with architect/writer agents and architect command"
      contains: "banneker-architect"
    - path: "test/integration/skill-validation.test.js"
      provides: "YAML frontmatter validation for new template files"
      contains: "banneker-architect"
    - path: "test/smoke/full-install.test.js"
      provides: "Installation verification for new files"
      contains: "banneker-architect"
  key_links:
    - from: "lib/constants.js"
      to: "lib/installer.js"
      via: "installer reads BANNEKER_FILES to know what to copy"
      pattern: "BANNEKER_FILES"
    - from: "lib/constants.js"
      to: "lib/uninstaller.js"
      via: "uninstaller reads BANNEKER_FILES to know what to remove"
      pattern: "BANNEKER_FILES"
    - from: "test/integration/skill-validation.test.js"
      to: "templates/agents/banneker-architect.md"
      via: "validates frontmatter structure"
      pattern: "banneker-architect"
---

<objective>
Update the installer manifest and tests to include all new Phase 4 files.

Purpose: The installer needs to know about the new agent files (banneker-architect.md, banneker-writer.md), the new command file (banneker-architect.md), and the new config file (document-catalog.md) so they get installed and uninstalled correctly. Tests must validate the new files have proper YAML frontmatter and install to the right directories.

Output: Updated lib/constants.js with new file entries, updated integration tests for YAML validation, and updated smoke tests for installation verification.
</objective>

<execution_context>
@/home/daniel/.claude/get-shit-done/workflows/execute-plan.md
@/home/daniel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Files to update
@lib/constants.js
@test/integration/skill-validation.test.js
@test/smoke/full-install.test.js

# Prior plan that established installer infrastructure for agents
@.planning/phases/03-survey-pipeline/03-03-SUMMARY.md

# New files that need to be registered (from 04-01, 04-02, 04-03)
@.planning/phases/04-document-generation/04-01-SUMMARY.md
@.planning/phases/04-document-generation/04-02-SUMMARY.md
@.planning/phases/04-document-generation/04-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update lib/constants.js with new file entries</name>
  <files>lib/constants.js</files>
  <action>
Update `lib/constants.js` to register all new Phase 4 files in the manifest.

**Add to BANNEKER_FILES array** (these are paths relative to install location, with prefixes for routing):
- `'banneker-architect.md'` — command file, installed to {runtime}/commands/banneker/
- `'agents/banneker-architect.md'` — agent file, installed to {runtime}/agents/
- `'agents/banneker-writer.md'` — agent file, installed to {runtime}/agents/
- `'config/document-catalog.md'` — config file, needs new prefix handling

**Add to AGENT_FILES array:**
- `'banneker-architect.md'`
- `'banneker-writer.md'`

**Handle config files:** The document-catalog.md is in templates/config/ and needs to be installed to {runtime}/config/ or similar. Check how the installer currently handles different prefixes in BANNEKER_FILES:
- Files without prefix → commands directory
- Files with `agents/` prefix → agents directory
- Files with `config/` prefix → need to add config directory support

Add a new constant if needed:
```javascript
export const CONFIG_FILES = [
  'document-catalog.md'
];
```

And add `'config/document-catalog.md'` to BANNEKER_FILES.

**Important:** Look at the existing BANNEKER_FILES array and AGENT_FILES array patterns. The installer uses the prefix (agents/) to determine routing. Follow this same pattern for config/ prefix. The installer.js may need a small update to handle the config/ prefix — check if the existing installer logic already handles arbitrary prefixes or if it only knows about agents/.

If installer.js needs updating to handle config/ prefix:
- Add logic parallel to agent file handling
- Config files install to {runtime.config}/banneker/config/ (keeping them namespaced under banneker)
- The config directory handling should follow the same pattern as agents directory handling

Keep constants.js clean and well-commented. Follow existing code style exactly.
  </action>
  <verify>
1. Run: `node -e "import('./lib/constants.js').then(m => { console.log('BANNEKER_FILES:', m.BANNEKER_FILES); console.log('AGENT_FILES:', m.AGENT_FILES); })"`
2. Verify BANNEKER_FILES contains: 'banneker-architect.md', 'agents/banneker-architect.md', 'agents/banneker-writer.md', 'config/document-catalog.md'
3. Verify AGENT_FILES contains: 'banneker-surveyor.md', 'banneker-architect.md', 'banneker-writer.md'
4. Verify no syntax errors: `node --check lib/constants.js`
  </verify>
  <done>constants.js BANNEKER_FILES includes all Phase 4 files, AGENT_FILES includes both new agents, config files handled</done>
</task>

<task type="auto">
  <name>Task 2: Update integration and smoke tests for new files</name>
  <files>test/integration/skill-validation.test.js, test/smoke/full-install.test.js</files>
  <action>
Update existing test files to cover the new Phase 4 template files.

**Update `test/integration/skill-validation.test.js`:**

Add test cases for the new template files. Follow the existing test pattern in the file (read it first to understand the established pattern):

For each new agent file (banneker-architect.md, banneker-writer.md):
- Test that file exists at templates/agents/ path
- Test that file starts with `---` (YAML frontmatter delimiter)
- Test that frontmatter contains `name:` field
- Test that frontmatter contains `description:` field
- Test that name matches expected value ("banneker-architect" or "banneker-writer")

For the new command file (banneker-architect.md):
- Test that file exists at templates/commands/ path
- Test that file starts with `---` (YAML frontmatter delimiter)
- Test that frontmatter contains `name:` field matching "banneker-architect"
- Test that frontmatter contains `description:` field

For the config file (document-catalog.md):
- Test that file exists at templates/config/ path
- Test that file does NOT start with `---` (config files have no frontmatter)
- Test that file contains "TECHNICAL-SUMMARY" (smoke check for content)

**Update `test/smoke/full-install.test.js`:**

Add verification that new files are installed to correct locations. Follow the existing test pattern:

- Verify `banneker-architect.md` command is installed to commands directory
- Verify `agents/banneker-architect.md` is installed to agents directory
- Verify `agents/banneker-writer.md` is installed to agents directory
- Verify `config/document-catalog.md` is installed to config directory (if config directory support was added to installer)

**Important:** Read the existing test files first to match their exact testing patterns, assertion styles, and organizational structure. Use the same describe/it blocks, same assertion methods, same file-reading patterns.
  </action>
  <verify>
1. Run: `node --test test/integration/skill-validation.test.js` — all tests pass
2. Run: `node --test test/smoke/full-install.test.js` — all tests pass (may need to run full install first)
3. Verify new test cases exist for: banneker-architect agent, banneker-writer agent, banneker-architect command, document-catalog config
  </verify>
  <done>Integration tests validate YAML frontmatter for all new template files, smoke tests verify installation of new files to correct directories</done>
</task>

</tasks>

<verification>
1. `lib/constants.js` has no syntax errors
2. BANNEKER_FILES contains entries for all 4 new files (1 command + 2 agents + 1 config)
3. AGENT_FILES contains 3 entries (surveyor + architect + writer)
4. Integration tests pass for all new template files
5. Smoke tests verify new files install correctly
6. `npm test` passes (all test suites green)
</verification>

<success_criteria>
- constants.js registers all Phase 4 files in BANNEKER_FILES
- AGENT_FILES includes banneker-architect.md and banneker-writer.md
- Integration tests validate YAML frontmatter for architect agent, writer agent, and architect command
- Integration tests validate config file exists with expected content
- Smoke tests verify new files install to correct directories
- All existing tests continue to pass (no regressions)
</success_criteria>

<output>
After completion, create `.planning/phases/04-document-generation/04-04-SUMMARY.md`
</output>
