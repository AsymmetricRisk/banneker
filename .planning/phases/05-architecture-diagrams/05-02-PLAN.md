---
phase: 05-architecture-diagrams
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - templates/commands/banneker-roadmap.md
autonomous: true

must_haves:
  truths:
    - "/banneker:roadmap command checks for survey.json and architecture-decisions.json before proceeding"
    - "Command detects resume conditions from diagrammer-state.md and .continue-here.md"
    - "Command spawns banneker-diagrammer agent for actual diagram generation"
    - "Command verifies output diagrams exist after agent completes"
  artifacts:
    - path: "templates/commands/banneker-roadmap.md"
      provides: "Command orchestrator for /banneker:roadmap"
      contains: "banneker-roadmap"
  key_links:
    - from: "templates/commands/banneker-roadmap.md"
      to: "templates/agents/banneker-diagrammer.md"
      via: "Spawns sub-agent for diagram generation"
      pattern: "banneker-diagrammer"
    - from: "templates/commands/banneker-roadmap.md"
      to: ".banneker/survey.json"
      via: "Prerequisite check before spawning agent"
      pattern: "survey\\.json"
    - from: "templates/commands/banneker-roadmap.md"
      to: ".banneker/state/diagrammer-state.md"
      via: "Resume detection"
      pattern: "diagrammer-state"
---

<objective>
Create the banneker-roadmap command orchestrator that manages the diagram generation lifecycle: prerequisite checks, resume detection, agent spawning, and output verification.

Purpose: This command file is the user-facing entry point for `/banneker:roadmap`. It follows the established command pattern from banneker-architect.md (Phase 4) — checking prerequisites, detecting resume conditions, spawning the sub-agent, and verifying outputs. The command does NOT generate diagrams itself; it delegates to banneker-diagrammer.

Output: `templates/commands/banneker-roadmap.md` — a complete command skill file with YAML frontmatter and orchestration logic.
</objective>

<execution_context>
@/home/daniel/.claude/get-shit-done/workflows/execute-plan.md
@/home/daniel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-architecture-diagrams/05-01-SUMMARY.md
@templates/commands/banneker-architect.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create banneker-roadmap command orchestrator</name>
  <files>templates/commands/banneker-roadmap.md</files>
  <action>
Create `templates/commands/banneker-roadmap.md` following the established command pattern from `templates/commands/banneker-architect.md`.

**YAML Frontmatter (match existing command format):**
```yaml
---
name: banneker-roadmap
description: "Generate architecture diagrams from survey data. Produces 4 self-contained HTML diagrams: executive roadmap, decision map, system map, and architecture wiring diagram. Supports resume if generation is interrupted."
---
```

**Command Structure (mirror banneker-architect.md exactly):**

**1. Role Introduction:**
"You are the roadmap command orchestrator. Your job is to manage the diagram generation lifecycle: check prerequisites, detect resume conditions, spawn the diagrammer sub-agent to generate HTML diagrams, and verify outputs on completion."

**2. Step 0: Prerequisite Check (MANDATORY)**

Check for survey.json:
```bash
cat .banneker/survey.json 2>/dev/null
```
If missing: Display "No survey data found at .banneker/survey.json" and "Run /banneker:survey first to conduct a discovery interview." Abort.

Check for architecture-decisions.json:
```bash
cat .banneker/architecture-decisions.json 2>/dev/null
```
If missing: Display "No architecture decisions found at .banneker/architecture-decisions.json" and "Run /banneker:survey first -- the decision gate phase creates this file." Abort.

**3. Step 1: Resume Detection (REQ-CONT-002)**

Check for `.banneker/state/.continue-here.md` first (handoff from Wave 1):
```bash
cat .banneker/state/.continue-here.md 2>/dev/null
```
If exists: Parse it to show what's complete (Wave 1) and what's next (Wave 2). Prompt user: "Found handoff from previous session. Wave 1 complete (3 diagrams). Resume with Wave 2? (y/N)"
- Yes: Proceed to Step 2 with resume context
- No: Prompt: "Start fresh? This will regenerate all diagrams. (y/N)"

Check for `.banneker/state/diagrammer-state.md` (interrupted generation):
```bash
cat .banneker/state/diagrammer-state.md 2>/dev/null
```
If exists: Parse to identify completed/remaining diagrams. Display status. Prompt resume.
- Yes: Proceed to Step 2 with resume context
- No: Prompt start fresh or abort

Check for existing diagrams (completed run):
```bash
ls .banneker/diagrams/*.html 2>/dev/null
```
If all 4 exist (executive-roadmap.html, decision-map.html, system-map.html, architecture-wiring.html): Display "All 4 architecture diagrams already exist." Prompt: "Regenerate? (y/N)"
- Yes: Delete existing diagrams and state, proceed to Step 2
- No: List existing diagram file paths and exit

**4. Step 2: Create Output Directory**
```bash
mkdir -p .banneker/diagrams
mkdir -p .banneker/state
```

**5. Step 3: Spawn Diagrammer Agent**
Spawn `banneker-diagrammer` sub-agent with context:
- Pass survey.json content (or instruct agent to read it)
- Pass architecture-decisions.json content (or instruct agent to read it)
- If resuming, pass the state file content so agent knows where to resume
- Instruct agent to generate diagrams to `.banneker/diagrams/`

**6. Step 4: Verify Outputs**
After agent completes, verify the expected diagrams were created.

Check for Wave 1 required diagrams (3 minimum):
```bash
test -f .banneker/diagrams/executive-roadmap.html && echo "executive-roadmap: OK"
test -f .banneker/diagrams/decision-map.html && echo "decision-map: OK"
test -f .banneker/diagrams/system-map.html && echo "system-map: OK"
```

Check for Wave 2 diagram:
```bash
test -f .banneker/diagrams/architecture-wiring.html && echo "architecture-wiring: OK"
```

Verification logic:
- If all 4 exist: Report success, list all file paths with sizes, suggest "Run `/banneker:appendix` to compile the HTML appendix"
- If only 3 exist (Wave 1 complete, Wave 2 missing): Check for `.continue-here.md`. If exists, report "Wave 1 complete. Wave 2 requires a new session. Run `/banneker:roadmap` again to generate the wiring diagram." If no handoff file, report partial completion as warning.
- If fewer than 3 exist: Report error listing which diagrams are missing. Suggest re-running.

**7. Step 5: Clean Up State (on full completion)**
If all 4 diagrams verified:
- Delete `.banneker/state/diagrammer-state.md` (no longer needed)
- Delete `.banneker/state/.continue-here.md` if it exists
- Display final summary with all 4 diagram file paths
  </action>
  <verify>
1. File exists: `test -f templates/commands/banneker-roadmap.md && echo "EXISTS"`
2. Has valid YAML frontmatter: First line is `---`, contains `name: banneker-roadmap`
3. Contains prerequisite checks: grep for "survey.json" and "architecture-decisions.json"
4. Contains resume detection: grep for "diagrammer-state.md" and ".continue-here.md"
5. Contains agent spawning: grep for "banneker-diagrammer"
6. Contains output verification: grep for "executive-roadmap.html" and "decision-map.html" and "system-map.html" and "architecture-wiring.html"
7. Contains Wave 1/Wave 2 partial completion handling
  </verify>
  <done>
- `templates/commands/banneker-roadmap.md` exists with valid YAML frontmatter (name: banneker-roadmap)
- Command follows established orchestrator pattern from banneker-architect.md
- Prerequisite checks for survey.json and architecture-decisions.json
- Resume detection for both interrupted generation and Wave 1 handoff
- Spawns banneker-diagrammer agent for actual generation
- Verifies all 4 diagram outputs after agent completes
- Handles partial completion (Wave 1 only) gracefully with handoff messaging
  </done>
</task>

</tasks>

<verification>
1. `templates/commands/banneker-roadmap.md` exists and follows established command file pattern
2. Command handles all lifecycle stages: prerequisites, resume, spawn, verify, cleanup
3. Consistent with banneker-architect.md command structure
</verification>

<success_criteria>
- Command file exists with complete orchestration logic for diagram generation
- Prerequisite, resume, spawn, verify, and cleanup stages all documented
- Partial completion (Wave 1 only) handled with clear user messaging
</success_criteria>

<output>
After completion, create `.planning/phases/05-architecture-diagrams/05-02-SUMMARY.md`
</output>
