---
phase: 07-export-feed-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - templates/agents/banneker-exporter.md
autonomous: true

must_haves:
  truths:
    - "Exporter agent knows how to produce GSD format (PROJECT.md, REQUIREMENTS.md, ROADMAP.md)"
    - "Exporter agent knows how to produce platform prompt under 4,000 words"
    - "Exporter agent knows how to produce generic summary via markdown concatenation"
    - "Exporter agent knows how to produce context bundle optimized for LLM consumption"
    - "GSD requirements use REQ-ID format with categories and traceability to survey data"
    - "GSD roadmap orders milestones by dependency (topological sort)"
  artifacts:
    - path: "templates/agents/banneker-exporter.md"
      provides: "Sub-agent with instructions for all 4 export formats"
      min_lines: 200
      contains: "REQ-.*-\\d{3}"
  key_links:
    - from: "templates/agents/banneker-exporter.md"
      to: ".banneker/survey.json"
      via: "reads survey data as primary source"
      pattern: "survey\\.json"
    - from: "templates/agents/banneker-exporter.md"
      to: ".banneker/documents/"
      via: "reads generated documents for export"
      pattern: "documents/"
    - from: "templates/agents/banneker-exporter.md"
      to: ".planning/"
      via: "writes GSD format output files"
      pattern: "\\.planning/"
    - from: "templates/agents/banneker-exporter.md"
      to: ".banneker/exports/"
      via: "writes platform prompt, summary, and context bundle"
      pattern: "exports/"
---

<objective>
Create the banneker-exporter sub-agent that contains all export logic for transforming Banneker artifacts into 4 downstream formats: GSD (PROJECT.md + REQUIREMENTS.md + ROADMAP.md), platform prompt (dense summary under 4,000 words), generic summary (concatenated markdown), and context bundle (LLM-optimized single file).

Purpose: The exporter agent is the core logic of Phase 7. It reads .banneker/ artifacts (survey.json, architecture-decisions.json, generated documents) and produces format-specific outputs. This is the "writer" equivalent for the export pipeline — the command orchestrator (Plan 02) will spawn this agent.

Output: `templates/agents/banneker-exporter.md` — a complete sub-agent prompt file with YAML frontmatter and detailed instructions for all 4 export formats.
</objective>

<execution_context>
@/home/daniel/.claude/get-shit-done/workflows/execute-plan.md
@/home/daniel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/07-export-feed-system/07-RESEARCH.md

# Pattern references — existing agent files
@templates/agents/banneker-publisher.md
@templates/agents/banneker-writer.md
@templates/agents/banneker-architect.md

# Config reference for document catalog pattern
@templates/config/document-catalog.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create banneker-exporter sub-agent with all 4 export format instructions</name>
  <files>templates/agents/banneker-exporter.md</files>
  <action>
Create `templates/agents/banneker-exporter.md` following the established agent file pattern (YAML frontmatter with `name` and `description` fields, then markdown instructions).

The agent must handle 4 export formats, each as a distinct section. The command orchestrator (Plan 02) will tell this agent which format(s) to generate via a parameter passed when spawning.

**YAML Frontmatter:**
```yaml
---
name: banneker-exporter
description: "Transform Banneker planning artifacts into downstream framework formats. Supports 4 export targets: GSD (.planning/ files), platform prompt (dense summary), generic summary (concatenated markdown), and context bundle (LLM-optimized single file)."
---
```

**Agent Structure (sections in order):**

1. **Role and Context** — You are the exporter sub-agent. You read `.banneker/` artifacts and produce format-specific exports. You are spawned by the banneker-feed command with a `format` parameter indicating which export(s) to generate.

2. **Source Data Loading** — Instructions to read:
   - `.banneker/survey.json` (REQUIRED for all formats)
   - `.banneker/architecture-decisions.json` (REQUIRED for GSD format, optional for others)
   - `.banneker/documents/*.md` (read all available documents)
   - List the 3 always-generated documents: TECHNICAL-SUMMARY.md, STACK.md, INFRASTRUCTURE-ARCHITECTURE.md
   - List conditional documents that may or may not exist
   - Handle missing files gracefully (warn but continue for optional files, abort for required files)

3. **Format: GSD** — Export to `.planning/` directory. Three files:

   a. **PROJECT.md** — Generate from survey.json project metadata:
      - Project name, one-line description, core value proposition
      - Target users (from survey actors)
      - Key walkthroughs summary
      - Technology decisions summary (from architecture-decisions.json)
      - Format: Standard GSD PROJECT.md with `# {Project Name} -- Project` heading

   b. **REQUIREMENTS.md** — Generate using REQ-ID format (REQ-EXPORT-005):
      - Heading: `# {Project Name} -- Requirements`
      - Extract requirements from survey data organized by category
      - Categories derived from survey structure: INST (installation/distribution), FUNC (functional from walkthroughs), DATA (data model/backend), UI (frontend/interface), SEC (security), PERF (performance), DOCS (documentation)
      - Each requirement: `- **REQ-{CATEGORY}-{NNN}** ({priority}): {description}. Source: {survey_field_path}.`
      - Priority: `must` for critical walkthrough steps, `should` for non-critical, `could` for nice-to-haves
      - Traceability: every REQ must cite its source field path in survey.json (e.g., `survey.walkthroughs[0].steps[2]`)
      - Group requirements by category with `## {CATEGORY}: {Category Name}` headings
      - Include decision references where applicable: `References: DEC-{NNN}`

   c. **ROADMAP.md** — Generate with dependency-ordered milestones (REQ-EXPORT-006):
      - Heading: `# {Project Name} -- Roadmap`
      - Derive phases/milestones from survey walkthroughs and architecture decisions
      - Order by dependency: infrastructure first, then auth/data, then core flows, then secondary flows, then polish
      - Use topological sort logic: for each milestone, list its dependencies; order so dependencies come first
      - Each phase includes: Goal, Requirements (REQ-IDs), Success Criteria, Complexity (S/M/L), Dependencies
      - Match the format of Banneker's own ROADMAP.md as reference

4. **Format: Platform Prompt** — Export to `.banneker/exports/platform-prompt.md` (REQ-EXPORT-002):
   - Single dense context document under 4,000 words
   - Heading: `# {Project Name} -- Platform Context`
   - Use map-reduce pattern: allocate word budget proportionally across sections
   - Include sections: Project Overview, Technology Stack, Architecture Decisions (key ones), Core Walkthroughs (condensed), Requirements Summary
   - Word counting: use `text.split(/\s+/).filter(w => w.length > 0).length` approach mentally — keep sections concise
   - Section-aware truncation: if approaching limit, complete current section or omit it entirely (do NOT truncate mid-sentence)
   - Add footer: `*Generated by Banneker. Word count: ~{N}. Omitted sections: {list or "none"}.*`

5. **Format: Generic Summary** — Export to `.banneker/exports/summary.md` (REQ-EXPORT-003):
   - Concatenated markdown of all available documents
   - Heading: `# {Project Name} -- Summary`
   - For each document in `.banneker/documents/`, add:
     - `<!-- Source: {filename} -->` comment
     - Full document content
     - `---` separator
   - Order: TECHNICAL-SUMMARY first, STACK second, INFRASTRUCTURE-ARCHITECTURE third, then remaining alphabetically
   - Include survey metadata as structured header section before documents

6. **Format: Context Bundle** — Export to `.banneker/exports/context-bundle.md` (REQ-EXPORT-004):
   - Single-file LLM agent context artifact
   - Heading: `# {Project Name} -- Context Bundle`
   - Subheading: `Generated: {ISO date}. This bundle contains project planning artifacts for LLM agent consumption.`
   - Include survey data as formatted JSON in fenced code block
   - Include architecture decisions as formatted JSON in fenced code block
   - Include priority documents (TECHNICAL-SUMMARY, STACK, INFRASTRUCTURE-ARCHITECTURE) in full
   - Include optional documents only if they exist (DEVELOPER-HANDBOOK, TECHNICAL-DRAFT, etc.)
   - Selective inclusion: prioritize quality over quantity — do not pad with low-value content
   - Separate sections with `---` dividers

7. **Output Directory Creation** — Before writing any export files, ensure output directories exist:
   - `.planning/` (for GSD format)
   - `.banneker/exports/` (for platform prompt, generic summary, context bundle)

8. **Completion Report** — After generating exports, report:
   - Which formats were generated
   - File paths and approximate sizes
   - Any warnings (missing optional documents, truncated sections)
   - Word count for platform prompt

**Important constraints:**
- Zero runtime dependencies — use only Node.js built-ins and LLM capabilities
- All survey data field references must use snake_case keys (project convention)
- Do NOT invent requirements — derive exclusively from survey data
- Do NOT include generic placeholder text — every line must be project-specific
- Handle partial data gracefully (some documents may not exist if user skipped phases)
  </action>
  <verify>
1. File exists: `ls templates/agents/banneker-exporter.md`
2. Has valid YAML frontmatter: first line is `---`, contains `name: banneker-exporter` and `description:` field, closes with `---`
3. Contains all 4 format sections: grep for "Format: GSD", "Format: Platform Prompt", "Format: Generic Summary", "Format: Context Bundle"
4. Contains REQ-ID format instructions: grep for `REQ-.*-.*NNN` or `REQ-{CATEGORY}`
5. Contains traceability instructions: grep for "Source:" and "survey" references
6. Contains dependency ordering instructions: grep for "topological" or "dependency" ordering
7. Contains word limit instructions: grep for "4,000 words" or "4000"
8. Contains graceful error handling: grep for "missing" and "gracefully"
9. File is at least 200 lines (comprehensive agent covering 4 formats)
  </verify>
  <done>
`templates/agents/banneker-exporter.md` exists with valid YAML frontmatter (name + description), contains detailed instructions for all 4 export formats (GSD, platform prompt, generic summary, context bundle), GSD section includes REQ-ID format with categories and traceability, roadmap section includes dependency ordering, platform prompt section includes 4,000 word limit with section-aware truncation, and all sections handle missing files gracefully.
  </done>
</task>

</tasks>

<verification>
1. `templates/agents/banneker-exporter.md` exists and has valid YAML frontmatter
2. Agent covers all 6 REQ-EXPORT requirements
3. REQ-EXPORT-001: GSD format section generates PROJECT.md, REQUIREMENTS.md, ROADMAP.md
4. REQ-EXPORT-002: Platform prompt section produces single document under 4,000 words
5. REQ-EXPORT-003: Generic summary section produces concatenated markdown
6. REQ-EXPORT-004: Context bundle section produces single-file agent context
7. REQ-EXPORT-005: Requirements use REQ-ID format with categories and traceability
8. REQ-EXPORT-006: Roadmap orders milestones by dependency
</verification>

<success_criteria>
- banneker-exporter.md is a well-structured agent prompt file following the established pattern (matching banneker-publisher.md, banneker-writer.md structure)
- All 4 export formats are documented with specific, actionable instructions
- GSD requirements section includes REQ-ID format, category grouping, priority levels, and source traceability
- GSD roadmap section includes dependency ordering logic
- Platform prompt section includes word budget and section-aware truncation
- Agent handles missing/partial source data gracefully
</success_criteria>

<output>
After completion, create `.planning/phases/07-export-feed-system/07-01-SUMMARY.md`
</output>
