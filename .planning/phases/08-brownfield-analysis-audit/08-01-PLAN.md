---
phase: 08-brownfield-analysis-audit
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - templates/agents/banneker-cartographer.md
autonomous: true

must_haves:
  truths:
    - "Cartographer agent can scan a codebase using Glob/Grep/Read tools"
    - "Cartographer produces a structured codebase-understanding.md document"
    - "Cartographer respects .gitignore-style exclusions (node_modules, dist, .git)"
    - "Cartographer handles large codebases via state file for resume"
  artifacts:
    - path: "templates/agents/banneker-cartographer.md"
      provides: "Codebase analysis sub-agent with file scanning and document generation"
      contains: "banneker-cartographer"
  key_links:
    - from: "templates/agents/banneker-cartographer.md"
      to: ".banneker/codebase-understanding.md"
      via: "agent writes output to .banneker/ directory"
      pattern: "codebase-understanding"
    - from: "templates/agents/banneker-cartographer.md"
      to: ".banneker/state/document-state.md"
      via: "state file for resume on context exhaustion"
      pattern: "document-state"
---

<objective>
Create the cartographer sub-agent that analyzes existing codebases and produces structured understanding documents.

Purpose: The cartographer is the core agent behind `/banneker:document`. It reads an existing codebase using CLI tools (Glob, Grep, Read), identifies technologies, patterns, and architecture, and writes a structured `codebase-understanding.md` to `.banneker/`. This enables Banneker to work with brownfield projects, not just greenfield surveys.

Output: `templates/agents/banneker-cartographer.md` - a complete agent prompt file with YAML frontmatter.
</objective>

<execution_context>
@/home/daniel/.claude/get-shit-done/workflows/execute-plan.md
@/home/daniel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-brownfield-analysis-audit/08-RESEARCH.md

# Reference existing agent files for pattern consistency
@templates/agents/banneker-exporter.md
@templates/agents/banneker-surveyor.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create cartographer agent prompt file</name>
  <files>templates/agents/banneker-cartographer.md</files>
  <action>
Create `templates/agents/banneker-cartographer.md` following the established agent file pattern (see banneker-exporter.md and banneker-surveyor.md for structure).

**YAML frontmatter:**
```yaml
---
name: banneker-cartographer
description: "Analyze existing codebases to produce structured understanding documents. Scans file trees, identifies technologies, patterns, and architecture, and writes codebase-understanding.md for brownfield project onboarding."
---
```

**Agent body must include these sections:**

1. **Role and Context** - You are the Banneker Cartographer. You analyze existing codebases to produce structured understanding documents. You are spawned by the banneker-document command orchestrator. You operate with zero runtime dependencies, using only CLI tools (Glob, Grep, Read, Bash) to scan files.

2. **Scan Strategy** - Define a 4-phase scanning approach:
   - Phase 1: Project metadata extraction (package.json, Cargo.toml, pyproject.toml, go.mod, etc. - detect project type)
   - Phase 2: Directory structure mapping (tree generation with common exclusions: node_modules, .git, dist, build, coverage, .next, .cache, out, __pycache__, .venv, target)
   - Phase 3: Technology and pattern detection (scan imports, dependencies, config files, framework indicators)
   - Phase 4: Architecture pattern identification (component structure, API patterns, state management, data flow)

3. **File Exclusion Rules** - MUST skip:
   - Directories: node_modules, .git, dist, build, coverage, .next, .cache, out, __pycache__, .venv, target, .DS_Store
   - Binary extensions: .png, .jpg, .jpeg, .gif, .svg, .ico, .woff, .woff2, .ttf, .eot, .zip, .tar, .gz, .pdf, .exe, .dll, .so, .dylib
   - Generated files: .min.js, .min.css, bundle.*, chunk.*
   - Files over 500KB (likely generated)

4. **Output Document Structure** - Define the exact structure of codebase-understanding.md:
   - Project Metadata (type, language, framework, analyzed date, file/line counts)
   - Directory Structure (tree view)
   - Technology Stack (frontend, backend, database, testing, etc.)
   - Key Patterns Detected (architecture, state management, routing, API communication)
   - Entry Points (main files, server files, CLI entry)
   - Configuration Files (with brief description of each)
   - Notable Patterns (custom hooks, abstractions, design patterns)
   - Dependencies Summary (key production deps, key dev deps)

5. **State Management for Resume** - For large codebases:
   - Write progress to `.banneker/state/document-state.md` after each phase completes
   - Track: which directories scanned, which phases complete, discovered patterns so far
   - On resume: read state file, skip completed phases, continue from last position
   - Delete state file only on successful completion

6. **Quality Rules:**
   - Every statement must be specific to THIS codebase (no generic examples)
   - List actual file paths, not hypothetical ones
   - Report actual dependency versions from lockfiles/manifests
   - If a section has no findings, write "None detected" not a placeholder
   - Monorepo detection: if multiple package.json/Cargo.toml found, note this and analyze each sub-project

7. **Completion Protocol:**
   - Write codebase-understanding.md to `.banneker/codebase-understanding.md`
   - Delete `.banneker/state/document-state.md` if it exists
   - Report: number of files scanned, number of directories scanned, time taken
   - If context exhausted mid-scan, leave state file for resume (do NOT delete it)

Do NOT include any JavaScript code in this file. This is a pure markdown prompt file that instructs an LLM agent. The agent uses CLI tools (Glob, Grep, Read) to scan files, not JavaScript.

Do NOT reference survey.json or architecture-decisions.json. The cartographer works with raw codebases, not Banneker survey outputs.
  </action>
  <verify>
1. File exists at templates/agents/banneker-cartographer.md
2. File starts with valid YAML frontmatter (--- delimiters, name field matches "banneker-cartographer")
3. File contains sections for: Role, Scan Strategy, File Exclusion, Output Structure, State Management, Quality Rules, Completion Protocol
4. File does NOT contain JavaScript code blocks with executable logic
5. File references .banneker/codebase-understanding.md as output path
6. File references .banneker/state/document-state.md for resume capability
  </verify>
  <done>
templates/agents/banneker-cartographer.md exists with YAML frontmatter (name: banneker-cartographer), contains all 7 required sections, follows the established agent file pattern, and provides complete instructions for codebase analysis without any runtime dependencies.
  </done>
</task>

</tasks>

<verification>
- `head -5 templates/agents/banneker-cartographer.md` shows valid YAML frontmatter
- Agent file follows same structural pattern as banneker-exporter.md and banneker-surveyor.md
- No JavaScript execution code (only CLI tool instructions)
- References correct output paths (.banneker/codebase-understanding.md, .banneker/state/document-state.md)
</verification>

<success_criteria>
- Cartographer agent file exists with valid frontmatter
- Agent instructions cover the complete codebase scanning workflow
- File exclusion rules prevent scanning binary/generated files
- State management enables resume on context exhaustion
- Output document structure is well-defined and specific
</success_criteria>

<output>
After completion, create `.planning/phases/08-brownfield-analysis-audit/08-01-SUMMARY.md`
</output>
