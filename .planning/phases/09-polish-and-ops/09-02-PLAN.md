---
phase: 09-polish-and-ops
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - templates/commands/banneker-plat.md
  - templates/agents/banneker-plat-generator.md
autonomous: true

must_haves:
  truths:
    - "/banneker:plat generates sitemap and route architecture from survey data"
    - "Plat command checks for survey.json prerequisite before proceeding"
    - "Plat generator agent extracts routes from walkthrough steps and groups by actor"
    - "Output is markdown documentation in .banneker/documents/, not XML sitemap"
  artifacts:
    - path: "templates/commands/banneker-plat.md"
      provides: "Platform architecture command orchestrator"
      contains: "banneker-plat"
    - path: "templates/agents/banneker-plat-generator.md"
      provides: "Sub-agent for route extraction and sitemap generation"
      contains: "banneker-plat-generator"
  key_links:
    - from: "templates/commands/banneker-plat.md"
      to: "templates/agents/banneker-plat-generator.md"
      via: "Task tool spawn"
      pattern: "banneker-plat-generator"
    - from: "templates/agents/banneker-plat-generator.md"
      to: ".banneker/survey.json"
      via: "survey data reading"
      pattern: "survey\\.json"
---

<objective>
Implement the plat (platform architecture) command and its sub-agent for generating sitemap and route architecture documentation.

Purpose: `/banneker:plat` generates a route inventory and platform architecture document from survey walkthrough data. This gives developers a quick visual map of their application's routes, endpoints, and navigation structure extracted from the structured interview.

Output: One command orchestrator and one sub-agent template file.
</objective>

<execution_context>
@/home/daniel/.claude/get-shit-done/workflows/execute-plan.md
@/home/daniel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@templates/commands/banneker-roadmap.md (reference for orchestrator + sub-agent pattern)
@templates/commands/banneker-architect.md (reference for prerequisite checking)
@templates/agents/banneker-diagrammer.md (reference for agent structure)
@.planning/phases/09-polish-and-ops/09-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement banneker-plat-generator agent</name>
  <files>templates/agents/banneker-plat-generator.md</files>
  <action>
Create templates/agents/banneker-plat-generator.md as a new sub-agent file.

The plat-generator agent must:

1. **Frontmatter:** name: banneker-plat-generator, description: "Extract routes, endpoints, and navigation structure from survey walkthroughs to generate platform architecture documentation"

2. **Input Contract:** Receives survey.json content (passed by orchestrator). Expects:
   - `walkthroughs` array with steps containing URLs, pages, API endpoints, navigation flows
   - `actors` array with actor types and roles
   - `project.type` for platform classification (web app, mobile, API, CLI, etc.)

3. **Route Extraction Logic:**
   - Scan each walkthrough step for URL patterns, page names, API endpoints, and navigation references
   - Extract routes from `steps[].action` and `steps[].system_response` fields
   - Identify API endpoints from backend-related walkthrough data
   - Classify routes as: pages (user-facing), API endpoints, admin routes, auth flows, static assets

4. **Route Grouping:**
   - Group routes by actor (which actor accesses which routes)
   - Group routes by feature area (from walkthrough names)
   - Identify shared routes (accessed by multiple actors)
   - Identify authentication boundaries (which routes require auth)

5. **Output Generation — sitemap.md:**
   Write `.banneker/documents/sitemap.md` containing:
   - Project name and type header
   - Hierarchical route tree grouped by feature area
   - For each route: path, method (GET/POST/etc. if API), actor access, auth requirement
   - Visual hierarchy using markdown indentation and bullet points

6. **Output Generation — route-architecture.md:**
   Write `.banneker/documents/route-architecture.md` containing:
   - Route inventory table (path | method | actor | auth | feature area)
   - Navigation flow for each actor (ordered sequence from walkthrough steps)
   - API surface summary (endpoints grouped by resource)
   - Auth boundary diagram (which routes are public vs protected)
   - Data flow annotations (which routes read/write which data from walkthrough data_changes)

7. **State Tracking:** Write progress to `.banneker/state/plat-state.md` following the established YAML frontmatter + markdown body pattern:
   ```
   ---
   command: plat
   status: in-progress
   started_at: [ISO timestamp]
   items_completed: N
   items_total: 2
   current_position: "Generating sitemap.md"
   ---
   ```

8. **Quality Rules:**
   - Every route must be traceable to a specific walkthrough step
   - No generic placeholder routes ("e.g., /api/users" when survey doesn't mention users)
   - If survey has insufficient route data, generate what's available and note gaps
   - Use project-specific terminology from survey.json (actor names, feature names)

The agent pattern follows banneker-diagrammer.md and banneker-architect.md structure.
  </action>
  <verify>
Verify the agent file has:
- Valid YAML frontmatter with name and description
- Route extraction logic referencing survey.json walkthrough structure
- Grouping by actor and feature area
- Two output files: sitemap.md and route-architecture.md
- State file tracking per REQ-CONT-001
- Quality rules preventing generic placeholders

```bash
grep "sitemap.md" templates/agents/banneker-plat-generator.md
grep "route-architecture.md" templates/agents/banneker-plat-generator.md
grep "plat-state.md" templates/agents/banneker-plat-generator.md
```
  </verify>
  <done>banneker-plat-generator.md contains a complete sub-agent for extracting routes from survey walkthroughs and generating sitemap.md and route-architecture.md with actor grouping, auth boundaries, and data flow annotations.</done>
</task>

<task type="auto">
  <name>Task 2: Implement banneker-plat command orchestrator</name>
  <files>templates/commands/banneker-plat.md</files>
  <action>
Create templates/commands/banneker-plat.md as a new command orchestrator file.

Follow the established orchestrator pattern from banneker-roadmap.md and banneker-architect.md.

The plat command orchestrator must:

1. **Frontmatter:** name: banneker-plat, description: "Generate sitemap and route architecture documentation from survey walkthrough data. Extracts routes, endpoints, and navigation flows grouped by actor and feature area."

2. **Step 0: Prerequisite Check** — Verify survey.json exists:
   ```bash
   cat .banneker/survey.json 2>/dev/null
   ```
   If not found: "Survey data required. Run /banneker:survey first." and exit.

3. **Step 1: Resume Detection (REQ-CONT-002)** — Check for existing state:
   - Read `.banneker/state/plat-state.md` if it exists (interrupted generation)
   - Check if `.banneker/documents/sitemap.md` and `.banneker/documents/route-architecture.md` already exist (completed generation)
   - If interrupted: offer resume or fresh start
   - If completed: offer overwrite or abort
   - If neither: proceed as fresh start

4. **Step 2: Ensure Directory Structure** — Create directories if needed:
   ```bash
   mkdir -p .banneker/documents
   mkdir -p .banneker/state
   ```

5. **Step 3: Spawn Plat Generator** — Use Task tool to spawn `banneker-plat-generator` agent:
   - Pass survey.json content
   - Pass architecture-decisions.json content if available (optional, for richer context)
   - Agent generates sitemap.md and route-architecture.md

6. **Step 4: Verify Outputs** — Check generated files:
   ```bash
   cat .banneker/documents/sitemap.md 2>/dev/null
   cat .banneker/documents/route-architecture.md 2>/dev/null
   ```
   Verify both files exist and are non-empty. Check for placeholder content violations.

7. **Step 5: Clean Up State** — On successful completion:
   - Delete `.banneker/state/plat-state.md` (state only needed during generation)
   - Display completion message with file paths and summary

8. **Requirements Compliance** section at the bottom listing:
   - REQ-CONT-001: State tracking via .banneker/state/plat-state.md
   - REQ-CONT-002: Resume detection in Step 1

The orchestrator delegates all generation work to the agent. It manages lifecycle: prerequisite checks, resume detection, agent spawning, output verification, and state cleanup.
  </action>
  <verify>
Verify the command file has:
- Valid YAML frontmatter with name and description
- Prerequisite check for survey.json
- Resume detection (REQ-CONT-002) checking state file and existing outputs
- Directory creation step
- Task tool spawn of banneker-plat-generator agent
- Output verification step
- State cleanup on completion
- Requirements compliance section

```bash
grep "REQ-CONT" templates/commands/banneker-plat.md
# Should show REQ-CONT-001 and REQ-CONT-002 references
grep "banneker-plat-generator" templates/commands/banneker-plat.md
# Should show agent spawn reference
```
  </verify>
  <done>banneker-plat.md contains a complete command orchestrator that checks prerequisites, handles resume detection, spawns the plat-generator agent, verifies outputs, and cleans up state. Follows established orchestrator pattern.</done>
</task>

</tasks>

<verification>
1. Both files exist with valid YAML frontmatter:
   ```bash
   head -5 templates/commands/banneker-plat.md
   head -5 templates/agents/banneker-plat-generator.md
   ```
2. Command orchestrator references the agent by name for Task tool spawning
3. Agent generates two output files (sitemap.md, route-architecture.md)
4. Command includes REQ-CONT-001 state tracking and REQ-CONT-002 resume detection
5. Both files use project-specific terminology, no generic placeholders
</verification>

<success_criteria>
- banneker-plat.md orchestrator follows the established pattern from roadmap/architect commands
- banneker-plat-generator.md agent extracts routes from survey walkthroughs
- Two output documents generated: sitemap.md and route-architecture.md
- Routes grouped by actor and feature area with auth boundaries
- Resume detection and state tracking comply with REQ-CONT-001/002
</success_criteria>

<output>
After completion, create `.planning/phases/09-polish-and-ops/09-02-SUMMARY.md`
</output>
