---
phase: 09-polish-and-ops
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - SECURITY.md
  - .github/workflows/publish.yml
  - package.json
autonomous: true

must_haves:
  truths:
    - "SECURITY.md documents STRIDE threat model for installer file-write surface"
    - "SECURITY.md covers all 6 STRIDE categories with concrete mitigations"
    - "Changelog generation runs in publish workflow, not at user runtime"
    - "auto-changelog is devDependency only, never shipped to users"
  artifacts:
    - path: "SECURITY.md"
      provides: "STRIDE threat model for installer file operations"
      contains: "STRIDE"
    - path: ".github/workflows/publish.yml"
      provides: "Changelog generation step in publish pipeline"
      contains: "auto-changelog"
    - path: "package.json"
      provides: "auto-changelog devDependency and changelog script"
      contains: "auto-changelog"
  key_links:
    - from: ".github/workflows/publish.yml"
      to: "package.json"
      via: "npm run changelog script"
      pattern: "changelog"
    - from: "SECURITY.md"
      to: "lib/installer.js"
      via: "threat model references installer behavior"
      pattern: "installer"
---

<objective>
Create the STRIDE threat model for installer security and add changelog automation to the publish workflow.

Purpose: REQ-SEC-003 requires a formal threat model documenting risks of the installer's file-write surface (writing to ~/.claude/, ~/.opencode/, ~/.gemini/). REQ-CICD-005 requires changelog automation for releases. Both are documentation and ops tasks with no new template files.

Output: SECURITY.md with STRIDE analysis, updated publish.yml with changelog generation, updated package.json with auto-changelog devDependency.
</objective>

<execution_context>
@/home/daniel/.claude/get-shit-done/workflows/execute-plan.md
@/home/daniel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@lib/installer.js (installer implementation to reference in threat model)
@lib/uninstaller.js (uninstaller implementation to reference in threat model)
@lib/constants.js (BANNEKER_FILES manifest referenced in threat model)
@.github/workflows/publish.yml (existing publish workflow to update)
@package.json (add devDependency)
@.planning/phases/09-polish-and-ops/09-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create STRIDE threat model in SECURITY.md</name>
  <files>SECURITY.md</files>
  <action>
Create SECURITY.md at the repository root with a formal STRIDE threat model.

The document must cover:

**1. Header and Scope:**
- Title: "Banneker Security Model"
- Scope: Installer file-write operations to user home directories
- Attack surface: List all directories the installer writes to (~/.claude/commands/, ~/.claude/agents/, ~/.claude/config/, ~/.opencode/, ~/.gemini/) plus VERSION file

**2. STRIDE Analysis — 6 categories, each with:**
- Threat description (specific to Banneker's installer)
- Existing mitigations (reference actual code: checkWritePermission(), VERSION detection, BANNEKER_FILES manifest, overwrite prompts)
- Risk rating (LOW/MEDIUM/HIGH)
- Residual risk (what remains after mitigations)

Categories:

**S - Spoofing:**
- Threat: Typosquat packages on npm mimicking "banneker"
- Mitigation: Official package name, npm provenance verification
- Risk: MEDIUM

**T - Tampering:**
- Threat 1: Installer overwrites existing user files without consent
- Mitigation: VERSION file detection + overwrite prompt (REQ-SEC-002, REQ-INST-004)
- Risk: LOW (prompt prevents silent overwrites)

- Threat 2: Malicious package modifies files after installation
- Mitigation: BANNEKER_FILES manifest tracks only known files; uninstall removes only tracked files
- Risk: LOW

**R - Repudiation:**
- Threat: No audit trail of installation actions
- Mitigation: Interactive prompts require explicit user consent; VERSION file marks installation; npm audit log available
- Risk: LOW

**I - Information Disclosure:**
- Threat 1: Installed files reveal runtime choice to other processes
- Mitigation: Runtime directories (~/.claude/) are already public convention; no sensitive data in template files
- Risk: LOW

- Threat 2: Survey data may contain project secrets
- Mitigation: Survey data is local-only (.banneker/), never transmitted. Users responsible for not storing secrets in survey responses.
- Risk: MEDIUM (user error)

**D - Denial of Service:**
- Threat: Installer disk exhaustion
- Mitigation: Total install ~100KB (template files only); no unbounded writes
- Risk: LOW

**E - Elevation of Privilege:**
- Threat 1: Installer writes to protected directories bypassing permissions
- Mitigation: checkWritePermission() in lib/installer.js verifies fs.accessSync(W_OK) before mkdir/write (REQ-SEC-001)
- Risk: LOW

- Threat 2: Installed markdown files execute code with user privileges
- Mitigation: Template files are markdown, not executable. Host runtime (Claude Code) interprets instructions at LLM inference time, not system execution.
- Risk: LOW

**3. Extended Surface — .banneker/ operations:**
- Brief analysis of file writes to .banneker/ by survey, architect, roadmap, appendix, feed, document, audit commands
- Note: These write to project-local directory (not home), lower risk than installer
- Key mitigation: All writes are to known subdirectories (state/, documents/, diagrams/, appendix/, exports/)

**4. Security Best Practices for Users:**
- Verify package source before installing
- Review installer prompts before confirming overwrites
- Do not store API keys or passwords in survey responses
- Use specific version tags in CI/CD pipelines
- Report vulnerabilities via GitHub Security Advisories

**5. Vulnerability Reporting:**
- GitHub Security Advisories as primary channel

Reference actual code patterns from lib/installer.js, lib/uninstaller.js, and lib/constants.js. Do NOT use generic security boilerplate — every mitigation must reference Banneker-specific implementation.
  </action>
  <verify>
Verify SECURITY.md has:
- All 6 STRIDE categories (Spoofing, Tampering, Repudiation, Information Disclosure, Denial of Service, Elevation of Privilege)
- At least 8 specific threats documented
- References to actual code (checkWritePermission, BANNEKER_FILES, VERSION)
- Risk ratings for each threat
- Extended surface analysis for .banneker/ operations
- User best practices section

```bash
grep -c "##" SECURITY.md
# Should show 10+ section headers
grep "checkWritePermission\|BANNEKER_FILES\|VERSION" SECURITY.md
# Should find code references
```
  </verify>
  <done>SECURITY.md contains a comprehensive STRIDE threat model covering all 6 categories with Banneker-specific threats, mitigations referencing actual code, risk ratings, extended surface analysis, and user security best practices.</done>
</task>

<task type="auto">
  <name>Task 2: Add changelog automation to publish workflow</name>
  <files>package.json, .github/workflows/publish.yml</files>
  <action>
Add changelog automation as a devDependency and integrate into the publish workflow.

**package.json changes:**
1. Add devDependencies section (currently none exists):
   ```json
   "devDependencies": {
     "auto-changelog": "^2.5.0"
   }
   ```
2. Add changelog script:
   ```json
   "scripts": {
     ...existing scripts...,
     "changelog": "auto-changelog --package --output CHANGELOG.md --commit-limit false"
   }
   ```

**Important:** auto-changelog is a devDependency (build-time only). It is NOT a runtime dependency. The zero-dependency constraint applies to runtime only. The `"files"` field in package.json already limits what ships to users (bin/, lib/, templates/, VERSION) — devDependencies are never included in the published package.

**.github/workflows/publish.yml changes:**
Add changelog generation step BEFORE the publish step. The updated workflow should:

1. Keep existing: checkout, setup Node.js (24.x), install deps (npm ci --ignore-scripts), run tests
2. Add NEW step after tests, before publish:
   ```yaml
   - name: Generate changelog
     run: npx auto-changelog --package --output CHANGELOG.md --commit-limit false

   - name: Commit changelog
     run: |
       git config user.name "github-actions[bot]"
       git config user.email "github-actions[bot]@users.noreply.github.com"
       git add CHANGELOG.md
       git diff --cached --quiet || git commit -m "docs: update CHANGELOG for ${{ github.ref_name }}"
       git push origin HEAD:main || true
   ```
3. Keep existing: publish step

The checkout step needs `fetch-depth: 0` added to get full git history for changelog generation. Update the existing checkout step:
```yaml
- name: Checkout code
  uses: actions/checkout@v4
  with:
    fetch-depth: 0
```

Also update permissions to allow pushing the changelog commit:
```yaml
permissions:
  contents: write  # Changed from read to write for changelog commit
  id-token: write
```

Do NOT create a `/banneker:changelog` runtime command. Changelog generation is CI-only.
  </action>
  <verify>
Verify changes:

```bash
# Check package.json has devDependency
grep "auto-changelog" package.json

# Check package.json has changelog script
grep "changelog" package.json

# Check publish.yml has changelog step
grep "auto-changelog\|changelog" .github/workflows/publish.yml

# Check publish.yml has full history checkout
grep "fetch-depth" .github/workflows/publish.yml

# Verify auto-changelog is NOT in files array (not shipped to users)
grep -A5 '"files"' package.json
```
  </verify>
  <done>package.json has auto-changelog as devDependency with changelog script. publish.yml generates and commits CHANGELOG.md before npm publish with full git history checkout. Zero-dependency runtime constraint preserved.</done>
</task>

</tasks>

<verification>
1. SECURITY.md exists with all 6 STRIDE categories and Banneker-specific mitigations
2. package.json has auto-changelog devDependency and changelog script
3. publish.yml generates changelog before publish with full git history
4. No new runtime dependencies added (verify `"dependencies"` key absent from package.json)
5. Template files in `"files"` array unchanged (auto-changelog not shipped)
</verification>

<success_criteria>
- SECURITY.md is a complete STRIDE threat model for the installer file-write surface with extended coverage for .banneker/ operations
- Changelog automation runs in GitHub Actions publish workflow only
- auto-changelog is devDependency, never shipped to users
- Publish workflow fetches full git history and commits CHANGELOG.md
- Zero-dependency runtime constraint fully preserved
</success_criteria>

<output>
After completion, create `.planning/phases/09-polish-and-ops/09-03-SUMMARY.md`
</output>
