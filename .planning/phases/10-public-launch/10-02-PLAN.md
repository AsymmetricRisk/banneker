---
phase: 10-public-launch
plan: 02
type: execute
wave: 2
depends_on: ["10-01"]
files_modified: []
autonomous: false

user_setup:
  - service: npm
    why: "Package publishing with trusted publishing OIDC"
    dashboard_config:
      - task: "Configure trusted publisher"
        location: "npmjs.com -> Package Settings -> Publishing -> Trusted Publishers"
        details: |
          1. Go to https://www.npmjs.com/package/banneker/access (or create package first)
          2. Navigate to Publishing -> Trusted Publishers
          3. Click "Add Trusted Publisher"
          4. Select "GitHub Actions"
          5. Fill in exactly:
             - GitHub Organization/Username: dsj7419
             - Repository: banneker
             - Workflow file: publish.yml
             - Environment: npm-production
          6. Save configuration

must_haves:
  truths:
    - "npm trusted publisher configured on npmjs.com"
    - "Git tag v0.2.0 exists and triggers publish workflow"
    - "Package published to npm registry with provenance"
    - "npx banneker runs successfully from npm registry"
    - "npm registry page shows README and metadata"
  artifacts:
    - path: "https://www.npmjs.com/package/banneker"
      provides: "Published npm package"
      contains: "0.2.0"
  key_links:
    - from: "GitHub Actions publish.yml"
      to: "npmjs.com trusted publisher"
      via: "OIDC authentication"
      pattern: "id-token: write"
    - from: "git tag v0.2.0"
      to: "GitHub Actions workflow"
      via: "tag trigger"
      pattern: "v*.*.*"
---

<objective>
Publish Banneker 0.2.0 to npm registry using trusted publishing and verify end-to-end installation from the registry.

Purpose: This is the final step to make Banneker publicly available. Trusted publishing ensures secure, provenance-attested packages without long-lived tokens.

Output: Banneker 0.2.0 live on npm registry, verifiable via `npx banneker` from any clean environment.
</objective>

<execution_context>
@/home/daniel/.claude/get-shit-done/workflows/execute-plan.md
@/home/daniel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-public-launch/10-RESEARCH.md
@.planning/phases/10-public-launch/10-01-SUMMARY.md
@.github/workflows/publish.yml
@package.json
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Configure npm trusted publisher</name>
  <action>
User must configure trusted publishing on npmjs.com before the first publish can succeed.

**Why this requires human action:** npmjs.com web UI requires authentication with your npm account. Claude cannot log into external services.

**Steps:**

1. Go to https://www.npmjs.com/ and log in to your account

2. If package doesn't exist yet:
   - The first `npm publish` will create it
   - OR manually reserve the name at https://www.npmjs.com/package/banneker
   - Note: You can configure trusted publisher before the package exists

3. Navigate to package settings:
   - Go to https://www.npmjs.com/settings/dsj7419/packages (or your username)
   - Click on "banneker" package
   - Go to "Settings" tab

4. Configure trusted publisher:
   - Click "Publishing" in left sidebar
   - Under "Trusted Publishers", click "Add Trusted Publisher"
   - Select "GitHub Actions" as provider
   - Fill in these EXACT values (case-sensitive):
     * **GitHub Organization/Username:** dsj7419
     * **Repository:** banneker
     * **Workflow file:** publish.yml
     * **Environment:** npm-production
   - Click "Add Trusted Publisher"

5. Verify configuration shows in the list

**IMPORTANT:** The workflow file must be exactly `publish.yml` (not `.github/workflows/publish.yml`). The environment must be exactly `npm-production` to match the workflow.
  </action>
  <verify>
Trusted publisher configuration visible on npmjs.com package settings page.
  </verify>
  <resume-signal>Type "configured" when trusted publisher is set up on npmjs.com</resume-signal>
</task>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 2: Create and push version tag</name>
  <action>
User must create the Git tag and push it to trigger the publish workflow.

**Why this requires human action:** Git push to remote requires authentication. Claude should not have push access to production repositories.

**Pre-flight checks (Claude will verify these first):**

1. Confirm version is 0.2.0:
   ```bash
   cat VERSION
   jq -r '.version' package.json
   ```

2. Confirm all tests pass:
   ```bash
   npm test
   ```

3. Confirm README exists:
   ```bash
   test -f README.md && echo "README exists"
   ```

4. Confirm no uncommitted changes:
   ```bash
   git status
   ```

**If all checks pass, user should run:**

```bash
# 1. Ensure on main branch with latest changes
git checkout main
git pull origin main

# 2. Create annotated tag
git tag -a v0.2.0 -m "Release v0.2.0 - Initial public release"

# 3. Push the tag (triggers publish workflow)
git push origin v0.2.0
```

**After pushing the tag:**

1. Go to https://github.com/dsj7419/banneker/actions
2. Watch the "Publish to npm" workflow
3. It should:
   - Checkout code
   - Setup Node.js 24.x
   - Install dependencies
   - Run tests
   - Generate changelog
   - Publish to npm (OIDC auth, no token needed)

**If workflow fails:**
- Check logs for error message
- Common issues: trusted publisher mismatch, Node version, test failure
- See 10-RESEARCH.md for troubleshooting
  </action>
  <verify>
GitHub Actions "Publish to npm" workflow completes successfully with green checkmark.
  </verify>
  <resume-signal>Type "published" when GitHub Actions workflow shows green and npm publish succeeded</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify post-publish success</name>
  <what-built>
Banneker 0.2.0 published to npm registry with:
- Complete README displayed on package page
- Repository, homepage, bugs links working
- Provenance attestation (Sigstore)
- Clean install via npx
  </what-built>
  <how-to-verify>
**1. Check npm registry page:**
- Visit https://www.npmjs.com/package/banneker
- Verify version shows 0.2.0
- Verify README content displays properly
- Verify "Repository" link goes to GitHub
- Verify "Homepage" link works
- Verify keywords appear in sidebar

**2. Check provenance (optional but recommended):**
```bash
npm view banneker --json | jq '.dist.attestations'
```
Should show provenance attestation (may take a few minutes to appear).

**3. Test clean install in temporary directory:**
```bash
cd $(mktemp -d)
npx banneker --help
```
Should display Banneker help/usage without errors.

**4. Test installer flow:**
```bash
cd $(mktemp -d)
npx banneker --claude --global
```
Should complete installation without errors.

**5. Verify installed version:**
```bash
npx banneker --version
```
Should show 0.2.0.

Report any issues found during verification.
  </how-to-verify>
  <resume-signal>Type "verified" if all checks pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. npm trusted publisher configured on npmjs.com (case-sensitive match with workflow)
2. Git tag v0.2.0 pushed to origin
3. GitHub Actions publish workflow completed successfully
4. Package visible at https://www.npmjs.com/package/banneker
5. README displays correctly on npm registry page
6. `npx banneker --help` works from clean environment
7. Version 0.2.0 shown when installed
</verification>

<success_criteria>
- Trusted publisher configured and saved on npmjs.com
- Git tag v0.2.0 triggers successful GitHub Actions publish
- npm registry shows banneker@0.2.0 with README and metadata
- `npx banneker` installs and runs correctly from npm registry
- Provenance attestation present on published package
</success_criteria>

<output>
After completion, create `.planning/phases/10-public-launch/10-02-SUMMARY.md`
</output>
