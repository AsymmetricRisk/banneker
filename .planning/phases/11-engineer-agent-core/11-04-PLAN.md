---
phase: 11-engineer-agent-core
plan: 04
type: execute
wave: 3
depends_on: ["11-01", "11-02", "11-03"]
files_modified:
  - lib/installer.js
  - test/installer.test.js
autonomous: true

must_haves:
  truths:
    - "Installer copies banneker-engineer.md to commands directory"
    - "Installer copies engineering-catalog.md to config directory"
    - "Tests verify engineer files are installed correctly"
    - "npx banneker installs engineer command"
  artifacts:
    - path: "lib/installer.js"
      provides: "Installer with engineer file handling"
      contains: "engineer"
    - path: "test/installer.test.js"
      provides: "Tests for engineer installation"
      contains: "engineer"
  key_links:
    - from: "lib/installer.js"
      to: "templates/commands/banneker-engineer.md"
      via: "copies command file during install"
      pattern: "cpSync"
    - from: "lib/installer.js"
      to: "templates/config/engineering-catalog.md"
      via: "copies config file during install"
      pattern: "cpSync"
---

<objective>
Update the installer manifest to include engineer files and add tests verifying correct installation of the engineer command.

Purpose: Ensure the engineer capability is properly installed when users run npx banneker, completing the engineer phase requirements.

Output: Updated installer.js and new tests for engineer installation.
</objective>

<execution_context>
@/home/daniel/.claude/get-shit-done/workflows/execute-plan.md
@/home/daniel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-engineer-agent-core/11-RESEARCH.md

# Installer to update
@lib/installer.js

# Test file to update
@test/installer.test.js

# Files to be installed (from Plans 01-03)
@templates/commands/banneker-engineer.md
@templates/agents/banneker-engineer.md
@templates/config/engineering-catalog.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify installer already handles new files</name>
  <files>lib/installer.js</files>
  <action>
Read lib/installer.js to confirm the installer uses recursive directory copy (cpSync) for:
1. templates/commands/ -> commandsDir
2. templates/agents/ -> configDir/agents/
3. templates/config/ -> configDir/config/

The installer should already handle new files automatically because it copies entire directories. Verify this pattern exists:

```javascript
// Copy command template files
const templatesDir = join(PACKAGE_ROOT, 'templates', 'commands');
cpSync(templatesDir, commandsDir, { recursive: true, force: true, ... });

// Copy agent template files
const agentsTemplatesDir = join(PACKAGE_ROOT, 'templates', 'agents');
cpSync(agentsTemplatesDir, agentsDir, { recursive: true, force: true, ... });

// Copy config template files
const configTemplatesDir = join(PACKAGE_ROOT, 'templates', 'config');
cpSync(configTemplatesDir, configTargetDir, { recursive: true, force: true, ... });
```

If this pattern exists, no changes needed to installer.js - new files in templates/ are automatically included.

If the installer uses explicit file lists instead of directory copies, update to include:
- templates/commands/banneker-engineer.md
- templates/agents/banneker-engineer.md
- templates/config/engineering-catalog.md

Document the finding in verification output.
  </action>
  <verify>
Read lib/installer.js and confirm:
- cpSync is used for templates/commands
- cpSync is used for templates/agents
- cpSync is used for templates/config
OR if explicit lists, engineer files are included
  </verify>
  <done>
Installer handles new template files (either via recursive copy or explicit inclusion).
  </done>
</task>

<task type="auto">
  <name>Task 2: Add engineer installation tests</name>
  <files>test/installer.test.js</files>
  <action>
Add tests for engineer file installation to test/installer.test.js. Follow the existing test patterns in the file.

**Add tests for engineer command file:**

```javascript
describe('Engineer command installation', () => {
  test('should copy banneker-engineer.md to commands directory', async () => {
    // Run installer in test mode
    // Verify templates/commands/banneker-engineer.md is copied to target
    const targetPath = join(commandsDir, 'banneker-engineer.md');
    expect(existsSync(targetPath)).toBe(true);
  });

  test('banneker-engineer.md should contain expected sections', async () => {
    const content = readFileSync(join(commandsDir, 'banneker-engineer.md'), 'utf8');
    // Verify key content
    expect(content).toContain('banneker-engineer');
    expect(content).toContain('survey.json');
    expect(content).toContain('DIAGNOSIS.md');
    expect(content).toContain('RECOMMENDATION.md');
    expect(content).toContain('ENGINEERING-PROPOSAL.md');
  });
});
```

**Add tests for engineer agent file:**

```javascript
describe('Engineer agent installation', () => {
  test('should copy banneker-engineer.md to agents directory', async () => {
    const targetPath = join(agentsDir, 'banneker-engineer.md');
    expect(existsSync(targetPath)).toBe(true);
  });

  test('banneker-engineer.md agent should contain expected sections', async () => {
    const content = readFileSync(join(agentsDir, 'banneker-engineer.md'), 'utf8');
    expect(content).toContain('Banneker Engineer');
    expect(content).toContain('survey.json');
    expect(content).toContain('engineer-state.md');
    expect(content).toContain('confidence');
  });
});
```

**Add tests for engineering-catalog.md:**

```javascript
describe('Engineering catalog installation', () => {
  test('should copy engineering-catalog.md to config directory', async () => {
    const targetPath = join(configDir, 'engineering-catalog.md');
    expect(existsSync(targetPath)).toBe(true);
  });

  test('engineering-catalog.md should define three documents', async () => {
    const content = readFileSync(join(configDir, 'engineering-catalog.md'), 'utf8');
    expect(content).toContain('DIAGNOSIS.md');
    expect(content).toContain('RECOMMENDATION.md');
    expect(content).toContain('ENGINEERING-PROPOSAL.md');
    expect(content).toMatch(/HIGH.*MEDIUM.*LOW|confidence/i);
  });
});
```

Integrate these tests into the existing test structure, following whatever setup/teardown patterns are already established.
  </action>
  <verify>
npm test passes with new engineer tests:
- Engineer command installation test passes
- Engineer agent installation test passes
- Engineering catalog installation test passes
  </verify>
  <done>
Tests verify engineer files (command, agent, config) are correctly installed.
  </done>
</task>

<task type="auto">
  <name>Task 3: Run full test suite</name>
  <files>test/installer.test.js</files>
  <action>
Run the full test suite to ensure:
1. All existing tests still pass (no regressions)
2. New engineer tests pass
3. No file copy conflicts or missing files

```bash
npm test
```

If any tests fail:
- For engineer-related failures: Fix the test or underlying code
- For unrelated failures: Note them but they may be pre-existing issues

Report test results in verification output.
  </action>
  <verify>
npm test output shows:
- All tests pass
- Specifically, engineer-related tests pass
  </verify>
  <done>
Full test suite passes including new engineer installation tests.
  </done>
</task>

</tasks>

<verification>
1. lib/installer.js handles engineer template files (via recursive copy or explicit inclusion)
2. test/installer.test.js has engineer installation tests
3. npm test passes with no regressions
4. New template files (banneker-engineer.md command, agent, engineering-catalog.md) confirmed installable
</verification>

<success_criteria>
- Installer copies all engineer files correctly
- Tests verify engineer file installation
- npx banneker will install engineer command (when published)
- Full test suite passes
</success_criteria>

<output>
After completion, create `.planning/phases/11-engineer-agent-core/11-04-SUMMARY.md`
</output>
