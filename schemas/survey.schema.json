{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://banneker.dev/schemas/survey.schema.json",
  "title": "Banneker Survey Output",
  "description": "Reference JSON Schema for the structured output of a Banneker 6-phase discovery interview. Defines survey.json structure for downstream consumption by GSD, architect, and other pipeline agents.",
  "type": "object",
  "required": [
    "survey_metadata",
    "project",
    "actors",
    "walkthroughs",
    "backend",
    "rubric_coverage"
  ],
  "properties": {
    "survey_metadata": {
      "type": "object",
      "description": "Metadata about the survey execution",
      "required": ["version", "created", "runtime"],
      "properties": {
        "version": {
          "type": "string",
          "description": "Survey schema version",
          "pattern": "^\\d+\\.\\d+$"
        },
        "created": {
          "type": "string",
          "description": "ISO 8601 timestamp of survey creation",
          "format": "date-time"
        },
        "runtime": {
          "type": "string",
          "description": "Runtime environment that executed the survey",
          "enum": ["claude-code", "opencode", "gemini-code"]
        },
        "status": {
          "type": "string",
          "enum": ["complete", "partial"],
          "description": "Survey completion status (partial indicates mid-survey mode switch)"
        }
      }
    },
    "project": {
      "type": "object",
      "description": "Core project information from Phase 1 (Pitch)",
      "required": ["name", "one_liner", "problem"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Project name",
          "minLength": 1
        },
        "one_liner": {
          "type": "string",
          "description": "Concise project description (1-2 sentences)",
          "minLength": 1
        },
        "problem": {
          "type": "string",
          "description": "Problem statement this project solves",
          "minLength": 1
        }
      }
    },
    "actors": {
      "type": "array",
      "description": "Actors (humans and systems) that interact with the project from Phase 2",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["name", "type", "role", "capabilities"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Actor name",
            "minLength": 1
          },
          "type": {
            "type": "string",
            "description": "Actor type",
            "enum": ["human", "system"]
          },
          "role": {
            "type": "string",
            "description": "Description of actor's role in the system",
            "minLength": 1
          },
          "capabilities": {
            "type": "array",
            "description": "List of actions this actor can perform",
            "minItems": 1,
            "items": {
              "type": "string",
              "minLength": 1
            }
          }
        }
      }
    },
    "walkthroughs": {
      "type": "array",
      "description": "User flows and system interactions from Phase 3",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["name", "type", "steps", "system_responses", "data_changes", "error_cases"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Walkthrough name",
            "minLength": 1
          },
          "type": {
            "type": "string",
            "description": "Walkthrough type",
            "enum": ["primary", "secondary", "error"]
          },
          "steps": {
            "type": "array",
            "description": "Sequence of user actions",
            "minItems": 1,
            "items": {
              "type": "string",
              "minLength": 1
            }
          },
          "system_responses": {
            "type": "array",
            "description": "System responses to user actions",
            "minItems": 1,
            "items": {
              "type": "string",
              "minLength": 1
            }
          },
          "data_changes": {
            "type": "array",
            "description": "Data modifications during walkthrough",
            "items": {
              "type": "string",
              "minLength": 1
            }
          },
          "error_cases": {
            "type": "array",
            "description": "Error scenarios and handling",
            "items": {
              "type": "string",
              "minLength": 1
            }
          }
        }
      }
    },
    "backend": {
      "type": "object",
      "description": "Backend/infrastructure details from Phase 4, or indication of N/A for frontend-only projects",
      "oneOf": [
        {
          "required": ["applicable"],
          "properties": {
            "applicable": {
              "type": "boolean",
              "const": false,
              "description": "Set to false for frontend-only or static projects"
            }
          }
        },
        {
          "required": ["data_stores", "integrations", "infrastructure", "applicable"],
          "properties": {
            "applicable": {
              "type": "boolean",
              "const": true,
              "description": "Set to true when backend details are provided"
            },
            "data_stores": {
              "type": "array",
              "description": "Databases, caches, and other data storage",
              "items": {
                "type": "string",
                "minLength": 1
              }
            },
            "integrations": {
              "type": "array",
              "description": "External services and APIs",
              "items": {
                "type": "string",
                "minLength": 1
              }
            },
            "infrastructure": {
              "type": "array",
              "description": "Hosting, deployment, and infrastructure choices",
              "items": {
                "type": "string",
                "minLength": 1
              }
            }
          }
        }
      ]
    },
    "rubric_coverage": {
      "type": "object",
      "description": "Gap analysis from Phase 5",
      "required": ["covered", "gaps"],
      "properties": {
        "covered": {
          "type": "array",
          "description": "Rubric categories addressed by the survey",
          "items": {
            "type": "string",
            "minLength": 1
          }
        },
        "gaps": {
          "type": "array",
          "description": "Rubric categories not yet addressed",
          "items": {
            "type": "string",
            "minLength": 1
          }
        }
      }
    },
    "cliff_signals": {
      "type": "array",
      "description": "Detected uncertainty signals during survey (optional, populated when cliff detection active)",
      "items": {
        "type": "object",
        "required": ["timestamp", "phase", "user_response", "detected_signal", "confidence"],
        "properties": {
          "timestamp": {
            "type": "string",
            "description": "ISO 8601 timestamp of detection",
            "format": "date-time"
          },
          "phase": {
            "type": "string",
            "description": "Survey phase where signal detected (pitch/actors/walkthroughs/backend/gaps)"
          },
          "question_context": {
            "type": "string",
            "description": "The question being asked when signal detected"
          },
          "user_response": {
            "type": "string",
            "description": "User's full response containing the signal"
          },
          "detected_signal": {
            "type": "string",
            "description": "The specific signal phrase that was detected"
          },
          "confidence": {
            "type": "string",
            "description": "Detection confidence level",
            "enum": ["HIGH", "MEDIUM", "LOW"]
          },
          "mode_switch_offered": {
            "type": "boolean",
            "description": "Whether mode switch was offered after this detection"
          },
          "user_accepted": {
            "type": "boolean",
            "description": "Whether user accepted mode switch (only set if offered)"
          }
        }
      }
    },
    "surveyor_notes": {
      "type": "object",
      "description": "Context summary from surveyor for engineer handoff (populated on mid-survey mode switch)",
      "properties": {
        "generated": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp when notes were generated"
        },
        "phase_at_switch": {
          "type": "string",
          "description": "Survey phase name when mode switch occurred"
        },
        "cliff_trigger": {
          "type": "string",
          "description": "User response that triggered the mode switch"
        },
        "survey_completeness_percent": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "description": "Estimated survey completion percentage at mode switch"
        },
        "preferences_observed": {
          "type": "array",
          "items": { "type": "string" },
          "description": "User preferences noted during conversation"
        },
        "implicit_constraints": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Constraints implied but not explicitly stated"
        },
        "confident_topics": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Topics where user provided confident responses"
        },
        "uncertain_topics": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Topics where user showed uncertainty"
        },
        "deferred_questions": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "phase": { "type": "string" },
              "question": { "type": "string" },
              "deferred_at": { "type": "string", "format": "date-time" }
            },
            "required": ["phase", "question", "deferred_at"]
          },
          "description": "Questions skipped during survey"
        },
        "engineer_guidance": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Recommendations for engineer based on conversation"
        }
      },
      "required": ["generated", "phase_at_switch"]
    }
  }
}
